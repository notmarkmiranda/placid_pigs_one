<%= button_to "Delete Season", @season, method: :delete %>
<%= link_to "<< League", @season.league %>
  <h3><%= @season.name %></h3>
<ul>
  <li>Start Date: <%= @season.formatted_start_date %></li>
  <li>End Date: <%= @season.formatted_end_date %></li>
  <li>Betting window: <%= @season.increment_lock %></li>
  <li>Offset: <%= @season.offset %></li>
</ul>

<table border=1>
  <tr>
    <td>Week #</td>
    <td>Date</td>
    <td>My Pick</td>
    <% @season.other_users(current_user.id).each do |user| %>
      <td><%= user.email %></td> 
    <% end %>
  </tr>
  <% @season.game_weeks.chronological.each_with_index do |week, index| %>
    <tr>
      <td rowspan=<%= week.rowspan %>><%= "#{index + 1}" %></td>
    </tr>
    <% week.all_dates.each do |date| %>
      <tr>
        <td><%= date.strftime("%A, %B %e, %Y") %></td>
        <td><!-- this is the current_user's picks //-->
        <% if @all_picks.by_date(date, current_user) %>
            <%= @all_picks.by_date(date, current_user).team.full_name %>
            <%= button_to "Delete Pick", @all_picks.by_date(date, current_user), method: :delete, disabled: week.locked? %>
        <% else %>
            <% if week.locked? %>
              The cutoff time has passed.
            <% else %>
              <%= form_for Pick.new do |f| %>
                <%= f.hidden_field :game_week_id, value: week.id %>
                <%= f.hidden_field :date, value: date %>
                <%= f.collection_select( :team_id, Team.all, :id, :full_name, include_blank: true) %>
                <%= f.submit %>
              <% end %>
            <% end %>
        <% end %>
        </td><!-- this is the current_user's picks //-->

        <td><!-- this will be other users' picks //-->
          <% if week.locked? %>
            <% if @all_picks.by_date(date, @season.other_users(current_user.id).first) %>
              <%= @all_picks.by_date(date, @season.other_users(current_user.id)).team.full_name %>
            <% else %>
              No pick
            <% end %>
          <% else %>
              Other users' picks will be shown after the cutoff has passed
          <% end %>
          <%# if cutoff has passed, show the picks %>
          <%# else show nothing? %>
        </td><!-- this will be other users' picks //-->
      </tr>
    <% end %>
  <% end %>
</table>

